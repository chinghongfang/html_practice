<!DOCTYPE html>
<html style="height:100%;">
<head>
	<title></title>
	<meta charset="utf-8">
	
	<link href="style/style.css" rel="stylesheet" type="text/css"><!---->
	<link rel="stylesheet" href="https://unpkg.com/swiper/css/swiper.css">
	<link rel="stylesheet" href="https://unpkg.com/swiper/css/swiper.min.css">
	
</head>
<body style="height:100%;">
	<div style="height:100%;margin:0px;"><!--vertical-align:middle;top:5%;position:absolute;-->
		<div style="text-align:center;">
			<h1>百萬彈幕</h1>
			<h3>～老師與學生們的交流神器～</h3></br>
		</div>
		<div style="height:20%;margin:5%;">
			<div style="height:100%;width:70%;float:left;">
				<input type="text" id="ans" value=""  style="width:90%;height:100%;font-size:100px;" onclick=change_pos()>
			</div>
			
			<div style="height:100%;float:left;">
				<!--<button type="button" style="height:100%;" onclick=Go()><image src="image/client2.png" style="width:auto;height:auto;max-width:100%;max-height:100%;"></button>
				-->
				<input type="image" src="https://raw.githubusercontent.com/chinghongfang/html_practice/master/image/client2.png" style="max-height:100%;" onclick=Go()></input>
				
			</div>
		</div>
		<div><p id="warningMsg" style="font-size:50px; color:red;"></p></div>
	
	
		<div class="swiper-container" style="height:20%;">
			<!-- Additional required wrapper -->
			<div class="swiper-wrapper" style="vertical-align:middle">
				<!-- Slides -->
				<div class="swiper-slide" style="text-align:center">
					<button type="button" class="symbol" id="agree" onclick=symbol("agree")>贊同</button>
					</div>
				<div class="swiper-slide" style="text-align:center">
					<button type="button" class="symbol" id="opisite" onclick=symbol("opisite")>反對</button></br>
					</div>
				<div class="swiper-slide" style="text-align:center">
					<button type="button" class="symbol" id="air_con" onclick=symbol("air_con")>老師可以開冷氣嗎</button>
					</div>
				<div class="swiper-slide" style="text-align:center">
					<button type="button" class="symbol" id="slower" onclick=symbol("slower")>老師可以講慢一點嗎</button></br>
					</div>
				<div class="swiper-slide" style="text-align:center">
					<button type="button" class="symbol" id="again" onclick=symbol("again")>可以再講一次嗎</button></br>
					</div>
				<div class="swiper-slide" style="text-align:center">
					<button type="button" class="symbol" id="break" onclick=symbol("break")>老師下課了</button>
					</div>
				<div class="swiper-slide" style="text-align:center">
					<button type="button" class="symbol" id="lunch" onclick=symbol("lunch")>中午吃啥</button></br>
					</div>
				<div class="swiper-slide" style="text-align:center">
					<button type="button" class="symbol" id="cold" onclick=symbol("cold")>冷氣好冷</button></br>
					</div>
				<div class="swiper-slide" style="text-align:center">
					<button type="button" class="symbol" id="sleepy" onclick=symbol("sleepy")>快睡著了</button>
					</div>
			</div>
			<!-- If we need pagination 
			<div class="swiper-pagination"></div>-->

			<!-- If we need navigation buttons 
			<div class="swiper-button-prev"></div>
			<div class="swiper-button-next"></div>-->

			<!-- If we need scrollbar 
			<div class="swiper-scrollbar"></div>-->
		</div>
		<style>
			.swiper-container{
				width: 80%;
				height: 100%;
			}
			.alignMiddle {
				height:100%;
			}
			.symbol {
				font-size: 50px;
				height:100%;
				background-image: url(https://raw.githubusercontent.com/chinghongfang/html_practice/master/image/button1.png);
				/*background-repeat: no-repeat;*/
				border:0px;
			}
		</style>
		<div style="height:10%;font-size:50px;margin-top:5%;margin-left:5%;">
			顏色：
			<label>
				<input type="radio" name="color" value="red" style="cursor:pointer;width:50px;height:50px;" checked>
				<image src="https://raw.githubusercontent.com/chinghongfang/html_practice/master/image/red.png" style="cursor:pointer;">
			</label>
			<label>
				<input type="radio" name="color" value="white" style="cursor:pointer;width:50px;height:50px;">
				<image src="https://raw.githubusercontent.com/chinghongfang/html_practice/master/image/white.png">
			</label>
			<label>
				<input type="radio" name="color" value="Grass" style="cursor:pointer;width:50px;height:50px;">
				<image src="https://raw.githubusercontent.com/chinghongfang/html_practice/master/image/green.png" style="cursor:pointer;">
			</label>
			<label>
				<input type="radio" name="color" value="Blue" style="cursor:pointer;width:50px;height:50px;">
				<image src="https://raw.githubusercontent.com/chinghongfang/html_practice/master/image/blue.png" style="cursor:pointer;">
			</label>
		</div>
	</div>
	
	
	<!--  Here is my real script  -->
	<script>
		var pos = 0;
		function change_pos(){
			pos = document.getElementById('ans').selectionStart;
			document.getElementById("warningMsg").innerHTML = ""
		}
		function symbol(id){
			//console.log(id)
			//console.log(document.getElementById(id).innerHTML);
			//console.log("Caret at: ", document.getElementById('ans').selectionStart)
			document.getElementById("warningMsg").innerHTML = ""
			
			let head = document.getElementById('ans').value.slice(0,pos)
			let tail = document.getElementById('ans').value.slice(pos)
			let data = document.getElementById(id).innerHTML;
			pos += data.length
			document.getElementById('ans').value = head.concat(data.concat(tail))
		}
		function text_check_change(){
			let data = document.getElementById('ans').value
			data = data.replace(/ϵ/g, "\\epsilon ")
			data = data.replace(/δ/g, "\\delta ")
			data = data.replace(/Σ/g, "\\Sigma ")
			data = data.replace(/Δ/g, "\\Delta ")
			data = data.replace(/π/g, "\\pi ")
			data = data.replace(/θ/g, "\\theta ")
			data = data.replace(/∀/g, "\\forall ")
			data = data.replace(/ζ/g, "\\zeta ")
			data = data.replace(/ξ/g, "\\xi ")
			return data
		}
		//var ws = new WebSocket("ws:localhost:8888");
	</script>
	
	<script src="https://unpkg.com/swiper/js/swiper.js"></script>
	<script src="https://unpkg.com/swiper/js/swiper.min.js"></script>
	<script>
	  var mySwiper = new Swiper ('.swiper-container', {
		// Optional parameters
		direction: 'vertical',//'horizontal',
		loop: false,
		slidesPerView: 3,
		spaceBetween: 5,

		// If we need pagination
		/*pagination: {
		  el: '.swiper-pagination',
		},*/

		// Navigation arrows
		/*navigation: {
		  nextEl: '.swiper-button-next',
		  prevEl: '.swiper-button-prev',
		},*/

		// And if we need scrollbar
		/*scrollbar: {
		  el: '.swiper-scrollbar',
		},*/
	  })
	</script>
	
	<!-- Insert these scripts at the bottom of the HTML, but before you use any Firebase services -->

	<!-- Firebase App (the core Firebase SDK) is always required and must be listed first 
	The original once
	<script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-app.js"></script>-->
	<script src="https://www.gstatic.com/firebasejs/7.6.0/firebase.js"></script>

	<!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
	<script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-analytics.js"></script>

	<!-- Add Firebase products that you want to use -->
	<script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.6.0/firebase-firestore.js"></script>
	<script>
	  // Your web app's Firebase configuration
	  var firebaseConfig = {
		apiKey: "AIzaSyBF2uPeIMPhyrmUyKfvTy9n7WkOSI85zmg",
		authDomain: "practice-2334f.firebaseapp.com",
		databaseURL: "https://practice-2334f.firebaseio.com",
		projectId: "practice-2334f",
		storageBucket: "practice-2334f.appspot.com",
		messagingSenderId: "906379530813",
		appId: "1:906379530813:web:f36ce20044f9c8f7111054",
		measurementId: "G-NK01QHSFQT"
	  };
	  // Initialize Firebase
	  firebase.initializeApp(firebaseConfig);
	  firebase.analytics();
		// Get a reference to the database service
		var database = firebase.database();
		function Go(){
			
			let text_to_send = text_check_change()
			if (text_to_send.length > 20){
				document.getElementById("warningMsg").innerHTML = "不能超過20字";
				return;
			}
			
			handleClick()
			
			document.getElementById('ans').value = "";
			// send something to server
			var d = new Date();
			let time = d.getTime();
			
			// get color radio box
			let colors = document.getElementsByName('color');
			let color;
			for (let i = 0; i< colors.length; ++i){
				if (colors[i].checked){
					color = colors[i].value;
					break;
				}
			}
			
			
			firebase.database().ref('/chatroom/'+time).set({
				message: text_to_send,
				color:	color
			});
			
		}
		const handleClick=()=>{
				// get color radio box
				let colors = document.getElementsByName('color');
				let color;
				for (let i = 0; i< colors.length; ++i){
					if (colors[i].checked){
						color = colors[i].value;
						break;
					}
				}

				var data={test:text_check_change(),color:color};

    			fetch( '/response',{
					method:"POST",
					body:JSON.stringify(data),
					headers: new Headers({
            					'Content-Type': 'application/json'
        				})
					 })
    			.then(res => res.json())
    			.then(data => {//i know
          			
    			})
    			.catch(e => {
        			console.log(e);
    			})
  		}
	</script>
</body>
</html>